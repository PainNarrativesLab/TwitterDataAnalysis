
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{User categorization}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    This is dedicated to determining which users are pain patients and which
conditions they have

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{o}{\PYZpc{}}\PY{k}{cd} twitteranalysis
        \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
        \PY{c+c1}{\PYZsh{}Plotting }
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k}{import} \PY{n}{pyplot} \PY{k}{as} \PY{n}{plt}
        \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        
        \PY{n}{sns}\PY{o}{.}\PY{n}{set}\PY{p}{(}\PY{n}{style}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{whitegrid}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        
        \PY{k+kn}{import} \PY{n+nn}{environment}
        \PY{k+kn}{from} \PY{n+nn}{DataTools} \PY{k}{import} \PY{n}{DataRepositories} \PY{k}{as} \PY{n}{DR}
        \PY{k+kn}{from} \PY{n+nn}{DataTools} \PY{k}{import} \PY{n}{DataConnections} \PY{k}{as} \PY{n}{DC}
        \PY{k+kn}{from} \PY{n+nn}{DataTools}\PY{n+nn}{.}\PY{n+nn}{WordORM} \PY{k}{import} \PY{n}{Word}
        \PY{k+kn}{from} \PY{n+nn}{DataTools}\PY{n+nn}{.}\PY{n+nn}{TweetORM} \PY{k}{import} \PY{n}{Users} \PY{k}{as} \PY{n}{User}
        \PY{k+kn}{from} \PY{n+nn}{DataTools}\PY{n+nn}{.}\PY{n+nn}{TweetORM} \PY{k}{import} \PY{n}{Tweet}
        \PY{k+kn}{from} \PY{n+nn}{SearchTools}\PY{n+nn}{.}\PY{n+nn}{WordMaps} \PY{k}{import} \PY{n}{get\PYZus{}adjacent\PYZus{}word\PYZus{}counts}\PY{p}{,} \PY{n}{get\PYZus{}adjacent\PYZus{}words}\PY{p}{,} \PY{n}{get\PYZus{}user\PYZus{}ids\PYZus{}for\PYZus{}word}
        
        \PY{n}{EXP\PYZus{}TERMS\PYZus{}FILEPATH} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/experimental\PYZhy{}terms.xlsx}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{environment}\PY{o}{.}\PY{n}{EXPERIMENTS\PYZus{}FOLDER}
        \PY{n}{IDS\PYZus{}FILEPATH} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{/temp\PYZus{}output/user\PYZhy{}ids.xlsx}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{environment}\PY{o}{.}\PY{n}{LOG\PYZus{}FOLDER\PYZus{}PATH}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(bookmark:twitteranalysis) -> /Users/adam/Dropbox/PainNarrativesLab/TwitterDataAnalysis
/Users/adam/Dropbox/PainNarrativesLab/TwitterDataAnalysis

    \end{Verbatim}

    \section{Find users whose profile contains an experimental
term}\label{find-users-whose-profile-contains-an-experimental-term}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{k}{def} \PY{n+nf}{get\PYZus{}rows\PYZus{}for\PYZus{}terms}\PY{p}{(}\PY{n}{wordFrame}\PY{p}{,} \PY{n}{experimentalTerms}\PY{p}{)}\PY{p}{:}
            \PY{k}{return} \PY{n}{wordFrame}\PY{p}{[}\PY{n}{wordFrame}\PY{o}{.}\PY{n}{term}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{experimentalTerms}\PY{p}{)}\PY{p}{]}
        
        
        \PY{k}{def} \PY{n+nf}{find\PYZus{}mapping}\PY{p}{(}\PY{n}{term}\PY{p}{,} \PY{n}{termMap}\PY{p}{)}\PY{p}{:}
            \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{termMap}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{index}\PY{p}{:}
                \PY{k}{if} \PY{n}{termMap}\PY{p}{[}\PY{n}{t}\PY{p}{]}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{contains}\PY{p}{(}\PY{n}{term}\PY{p}{)}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                    \PY{k}{return} \PY{n}{t}
            \PY{k}{return} \PY{k+kc}{False}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{c+c1}{\PYZsh{} load in terms to search for}
        \PY{n}{experimentalTerms} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}excel}\PY{p}{(}\PY{n}{EXP\PYZus{}TERMS\PYZus{}FILEPATH}\PY{p}{,} \PY{n}{sheet\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{terms}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{squeeze}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{n}{termMap} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}excel}\PY{p}{(}\PY{n}{EXP\PYZus{}TERMS\PYZus{}FILEPATH}\PY{p}{,} \PY{n}{sheet\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mapping}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{o}{\PYZpc{}}\PY{k}{time}
        
        \PY{c+c1}{\PYZsh{} iterate through each of the experimental terms, }
        \PY{c+c1}{\PYZsh{} getting user ids for each.}
        
        \PY{n}{ids} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{termMap}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{index}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{n}{t}\PY{p}{)}
            \PY{n}{users} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{subterm} \PY{o+ow}{in} \PY{n}{termMap}\PY{p}{[}\PY{n}{t}\PY{p}{]}\PY{p}{:}
                \PY{n}{users} \PY{o}{+}\PY{o}{=} \PY{p}{[}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{get\PYZus{}user\PYZus{}ids\PYZus{}for\PYZus{}word}\PY{p}{(}\PY{n}{subterm}\PY{p}{)}\PY{p}{]}
            \PY{n}{users} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{set}\PY{p}{(}\PY{n}{users}\PY{p}{)}\PY{p}{)}
            \PY{n}{ids}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{users}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{n}{t}\PY{p}{)}\PY{p}{)}
            
        \PY{n}{ids} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{ids}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Save results}
        \PY{n}{ids}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{to\PYZus{}excel}\PY{p}{(}\PY{n}{IDS\PYZus{}FILEPATH}\PY{p}{)} 
        
        \PY{n+nb}{len}\PY{p}{(}\PY{n}{ids}\PY{p}{)}
\end{Verbatim}


    \section{Counts of tweets belonging to users and broken out by
condition}\label{counts-of-tweets-belonging-to-users-and-broken-out-by-condition}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{test\PYZus{}user\PYZus{}id1} \PY{o}{=} \PY{l+m+mi}{10712602}
        \PY{n}{test\PYZus{}user\PYZus{}id2} \PY{o}{=} \PY{l+m+mi}{7609402}
        \PY{n}{test\PYZus{}tweet\PYZus{}id} \PY{o}{=} \PY{l+m+mi}{340493586317582340}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k}{def} \PY{n+nf}{get\PYZus{}tweet\PYZus{}count}\PY{p}{(}\PY{n}{userId}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Returns how many tweets we have for the given user id\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{k}{return} \PY{n}{dao}\PY{o}{.}\PY{n}{session}\PY{o}{.}\PY{n}{query}\PY{p}{(}\PY{n}{Tweet}\PY{p}{)}\PY{o}{.}\PY{n}{filter}\PY{p}{(}\PY{n}{Tweet}\PY{o}{.}\PY{n}{userID} \PY{o}{==} \PY{n}{userId}\PY{p}{)}\PY{o}{.}\PY{n}{count}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}tweets}\PY{p}{(}\PY{n}{userId}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Returns all tweets belonging to the user\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{k}{return} \PY{n}{dao}\PY{o}{.}\PY{n}{session}\PY{o}{.}\PY{n}{query}\PY{p}{(}\PY{n}{Tweet}\PY{p}{)}\PY{o}{.}\PY{n}{filter}\PY{p}{(}\PY{n}{Tweet}\PY{o}{.}\PY{n}{userID} \PY{o}{==} \PY{n}{userId}\PY{p}{)}\PY{o}{.}\PY{n}{all}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}tweet\PYZus{}timestamps}\PY{p}{(}\PY{n}{userId}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Returns the `created\PYZus{}at` field` for all tweets belonging to the given user \PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{k}{return} \PY{p}{[}\PY{n}{x}\PY{o}{.}\PY{n}{created\PYZus{}at} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{get\PYZus{}tweets}\PY{p}{(}\PY{n}{userId}\PY{p}{)}\PY{p}{]}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}user}\PY{p}{(}\PY{n}{userId}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Returns the user object for the id\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{k}{return} \PY{n}{dao}\PY{o}{.}\PY{n}{session}\PY{o}{.}\PY{n}{query}\PY{p}{(}\PY{n}{User}\PY{p}{)}\PY{o}{.}\PY{n}{filter}\PY{p}{(}\PY{n}{User}\PY{o}{.}\PY{n}{userID} \PY{o}{==} \PY{n}{userId}\PY{p}{)}\PY{o}{.}\PY{n}{all}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \subsection{load data}\label{load-data}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{e} \PY{o}{=} \PY{n}{DC}\PY{o}{.}\PY{n}{initialize\PYZus{}engine}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mysql}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{dao} \PY{o}{=} \PY{n}{DC}\PY{o}{.}\PY{n}{DAO}\PY{p}{(}\PY{n}{e}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
creating connection: mysql 

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{c+c1}{\PYZsh{} load userids from file}
        \PY{n}{userIds} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}excel}\PY{p}{(}\PY{n}{IDS\PYZus{}FILEPATH}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{c+c1}{\PYZsh{} display counts for each condition}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of user descriptions containing the term }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{k}{for} \PY{n}{r} \PY{o+ow}{in} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{userIds}\PY{p}{[}\PY{n}{r}\PY{p}{]}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Number of user descriptions containing the term 

 crps: 673
 migraine: 746
 fibromyalgia: 4123
 spoonie: 2008
 vulvodynia: 21
 endometriosis: 1064
 neuropathy: 143
 arthritis: 1439
 rhem\_arthritis: 621
 shingles: 21
 backpain: 77
 headache: 302

    \end{Verbatim}

    \subsection{Calculate tweet counts for each
condition}\label{calculate-tweet-counts-for-each-condition}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{n}{counts} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
        
        \PY{k}{for} \PY{n}{condition} \PY{o+ow}{in} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
            \PY{n}{counts}\PY{p}{[}\PY{n}{condition}\PY{p}{]} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{user\PYZus{}id} \PY{o+ow}{in} \PY{n}{userIds}\PY{p}{[}\PY{n}{condition}\PY{p}{]}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                \PY{c+c1}{\PYZsh{} look up the number of tweets that we\PYZsq{}ve captured}
                \PY{c+c1}{\PYZsh{} by the user.}
                \PY{n}{r} \PY{o}{=} \PY{p}{(}\PY{n}{user\PYZus{}id}\PY{p}{,} \PY{n}{get\PYZus{}tweet\PYZus{}count}\PY{p}{(}\PY{n}{user\PYZus{}id}\PY{p}{)}\PY{p}{)}
                \PY{n}{counts}\PY{p}{[}\PY{n}{condition}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{r}\PY{p}{)} 
        
        \PY{c+c1}{\PYZsh{} yes, we\PYZsq{}re cheating with scope. Don\PYZsq{}t move these functions without}
        \PY{c+c1}{\PYZsh{} ensuring that counts will still be available}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}non\PYZus{}zero}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Returns user ids for users who have used a targeted}
        \PY{l+s+sd}{    term in their profile, and who have tweeted at least once}
        \PY{l+s+sd}{    using a term which was picked up by the miner. }
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    NB, this does not mean that the term in the tweet(s) was}
        \PY{l+s+sd}{    the same term found in their profile.}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    Note that this is dependent on the particular scope}
        \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{k}{return} \PY{p}{[}\PY{n}{x} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{counts}\PY{p}{[}\PY{n}{condition}\PY{p}{]} \PY{k}{if} \PY{n}{x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mi}{1}\PY{p}{]}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}num\PYZus{}non\PYZus{}zero}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{:}
            \PY{k}{return} \PY{n+nb}{len}\PY{p}{(}\PY{n}{get\PYZus{}non\PYZus{}zero}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{)}
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}num}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{:}
            \PY{k}{return} \PY{n+nb}{len}\PY{p}{(}\PY{n}{counts}\PY{p}{[}\PY{n}{condition}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \subsection{Count how many users we have captured tweets
for}\label{count-how-many-users-we-have-captured-tweets-for}

This is needed because the miner searches for users with the term in
their profile and tweets. It stores them in the same way

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{n}{non\PYZus{}zero\PYZus{}counts} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
        
        \PY{k}{for} \PY{n}{condition} \PY{o+ow}{in} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
            \PY{n}{non\PYZus{}zero\PYZus{}counts}\PY{p}{[}\PY{n}{condition}\PY{p}{]} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descripts containing term}\PY{l+s+s1}{\PYZsq{}} \PY{p}{:} \PY{n}{get\PYZus{}num}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{users with 1+ tweets}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{get\PYZus{}num\PYZus{}non\PYZus{}zero}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{\PYZcb{}}
        
        \PY{n}{non\PYZus{}zero\PYZus{}counts} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{non\PYZus{}zero\PYZus{}counts}\PY{p}{)}
\end{Verbatim}


    \subsubsection{Results}\label{results}

This means that 1439 users had the word 'arthritis' in their profile
(twitter calls it a 'description'). However, we only have at least 1
tweet for 77 of the 1439. That's because the mining program's query
returned both users with the term in their description and tweets
containing the search term.

As part of our research, we will probably want to set up a new search
which pulls in tweets for a sample of the remaining users. That should
be done after we figure out how to filter out some of the bots and
commercial accounts.

\textbf{Users with 1+ tweets}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{non\PYZus{}zero\PYZus{}counts}\PY{o}{.}\PY{n}{T}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
        \PY{n}{non\PYZus{}zero\PYZus{}counts}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{kind}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bar}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{axes}\PY{p}{)}
        \PY{n}{axes}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Users with target terms in profile and captured terms in tweets}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \textbf{Distribution of the counts}

The x axis is 'Number of tweets'. Had trouble with the formatting

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{non\PYZus{}empty} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        \PY{k}{for} \PY{n}{cond} \PY{o+ow}{in} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
            \PY{n}{c} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{p}{[}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{get\PYZus{}non\PYZus{}zero}\PY{p}{(}\PY{n}{cond}\PY{p}{)}\PY{p}{]}\PY{p}{)}
            \PY{k}{if} \PY{n+nb}{len}\PY{p}{(}\PY{n}{c}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{non\PYZus{}empty}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{cond}\PY{p}{,} \PY{n}{c}\PY{p}{)}\PY{p}{)}
        
        \PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{ncols}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{nrows}\PY{o}{=}\PY{n+nb}{len}\PY{p}{(}\PY{n}{non\PYZus{}empty}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{)}\PY{p}{)}
        \PY{n}{i} \PY{o}{=} \PY{l+m+mi}{0}
        \PY{k}{for} \PY{n}{cond}\PY{p}{,} \PY{n}{series} \PY{o+ow}{in} \PY{n}{non\PYZus{}empty}\PY{p}{:}
        \PY{c+c1}{\PYZsh{}     series.plot(kind=\PYZsq{}kde\PYZsq{}, title=cond, ax=axes[i])}
            \PY{n}{sns}\PY{o}{.}\PY{n}{violinplot}\PY{p}{(}\PY{n}{series}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;} \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{cond}\PY{p}{)}\PY{p}{;} \PY{c+c1}{\PYZsh{}axes[i].set\PYZus{}x\PYZus{}label(\PYZsq{}\PYZsh{} tweets\PYZsq{})}
            \PY{n}{i} \PY{o}{+}\PY{o}{=}\PY{l+m+mi}{1}
        \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \section{Temporal distribution of captured
tweets}\label{temporal-distribution-of-captured-tweets}

We should know whether the tweets containing terms of interest are
evenly distributed over the capture period.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}63}]:} \PY{k}{def} \PY{n+nf}{make\PYZus{}timestamp\PYZus{}frame}\PY{p}{(}\PY{n}{terms}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Creates the data we need \PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{ts} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{i} \PY{o}{=} \PY{l+m+mi}{1}
             \PY{k}{for} \PY{n}{term} \PY{o+ow}{in} \PY{n}{terms}\PY{p}{:}
                 \PY{k}{for} \PY{n}{u}\PY{p}{,} \PY{n}{c} \PY{o+ow}{in} \PY{n}{get\PYZus{}non\PYZus{}zero}\PY{p}{(}\PY{n}{term}\PY{p}{)}\PY{p}{:}
                     \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{get\PYZus{}tweet\PYZus{}timestamps}\PY{p}{(}\PY{n}{u}\PY{p}{)}\PY{p}{:}
                         \PY{n}{ts}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{\PYZob{}} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tweetTime}\PY{l+s+s1}{\PYZsq{}} \PY{p}{:} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{t}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tweet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{term}\PY{l+s+s1}{\PYZsq{}} \PY{p}{:} \PY{n}{term}\PY{p}{\PYZcb{}}\PY{p}{)}
                 \PY{n}{i} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{ : }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{term}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{ts}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{n}{ts} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{ts}\PY{p}{)}
             \PY{k}{return} \PY{n}{ts}
         
         \PY{n}{terms} \PY{o}{=} \PY{p}{[}\PY{n}{t} \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{]}
         
         \PY{c+c1}{\PYZsh{} load the data}
         \PY{n}{tweet\PYZus{}timestamps} \PY{o}{=} \PY{n}{make\PYZus{}timestamp\PYZus{}frame}\PY{p}{(}\PY{n}{terms}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
crps : 446
migraine : 560
fibromyalgia : 2667
spoonie : 3494
vulvodynia : 3494
endometriosis : 3813
neuropathy : 3964
arthritis : 4358
rhem\_arthritis : 4555
shingles : 4557
backpain : 4805
headache : 4819

    \end{Verbatim}

    \paragraph{Plot helpers}\label{plot-helpers}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}59}]:} \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{palettes} \PY{k}{import} \PY{n}{Spectral6}\PY{p}{,} \PY{n}{Category20}\PY{p}{,} \PY{n}{magma}\PY{p}{,} \PY{n}{inferno}\PY{p}{,} \PY{n}{viridis}
         
         \PY{k}{def} \PY{n+nf}{color\PYZus{}generator}\PY{p}{(}\PY{n}{num\PYZus{}colors}\PY{p}{,} \PY{n}{palette\PYZus{}function}\PY{o}{=}\PY{n}{viridis}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Returns a color from the relevant palette\PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{colorlist} \PY{o}{=} \PY{n}{palette\PYZus{}function}\PY{p}{(}\PY{n}{num\PYZus{}colors}\PY{p}{)}
             \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{colorlist}\PY{p}{:}
                 \PY{k}{yield} \PY{n}{c}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}32}]:} \PY{c+c1}{\PYZsh{} Make a dictionary to hardcode in ticker}
         \PY{n}{dd} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{)} \PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
             \PY{n}{dd}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
         \PY{n}{dd}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}32}]:} \{1: 'crps',
          2: 'migraine',
          3: 'fibromyalgia',
          4: 'spoonie',
          5: 'vulvodynia',
          6: 'endometriosis',
          7: 'neuropathy',
          8: 'arthritis',
          9: 'rhem\_arthritis',
          10: 'shingles',
          11: 'backpain',
          12: 'headache'\}
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}40}]:} \PY{k}{def} \PY{n+nf}{ticker}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Replaces the numeric y axis label with the correct term}
         \PY{l+s+sd}{    The dict seems to need to be hardcoded since bokeh}
         \PY{l+s+sd}{    messes with any args or values which seem like they should be }
         \PY{l+s+sd}{    in scope\PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{dd} \PY{o}{=} \PY{p}{\PYZob{}}
                 \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crps}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{2}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{migraine}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{3}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{fibromyalgia}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{4}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{spoonie}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{5}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{vulvodynia}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{6}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{endometriosis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{7}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{neuropathy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{8}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{arthritis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{9}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rhem\PYZus{}arthritis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{10}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{shingles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{11}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{backpain}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{l+m+mi}{12}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{headache}\PY{l+s+s1}{\PYZsq{}}
             \PY{p}{\PYZcb{}}
         
             \PY{n}{term} \PY{o}{=} \PY{n}{dd}\PY{o}{.}\PY{n}{get}\PY{p}{(} \PY{n}{tick} \PY{p}{)}
             \PY{k}{return} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(} \PY{n}{term} \PY{p}{)}
\end{Verbatim}


    \subsubsection{Plot the tweet distributions for each
condition}\label{plot-the-tweet-distributions-for-each-condition}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}61}]:} \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{io} \PY{k}{import} \PY{n}{show}
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{ColumnDataSource}
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{plotting} \PY{k}{import} \PY{n}{figure}
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{sampledata}\PY{n+nn}{.}\PY{n+nn}{commits} \PY{k}{import} \PY{n}{data}
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{transform} \PY{k}{import} \PY{n}{jitter}
         
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{plotting} \PY{k}{import} \PY{o}{*}
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{FuncTickFormatter}
         \PY{k+kn}{from} \PY{n+nn}{bokeh}\PY{n+nn}{.}\PY{n+nn}{models}\PY{n+nn}{.}\PY{n+nn}{tickers} \PY{k}{import} \PY{n}{FixedTicker}
         
         
         \PY{k}{def} \PY{n+nf}{plot\PYZus{}tweet\PYZus{}distributions}\PY{p}{(}\PY{n}{frame}\PY{p}{,} \PY{n}{terms}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tweet frequencies}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
             \PY{n}{colorgen} \PY{o}{=} \PY{n}{color\PYZus{}generator}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{terms}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} initialize the notebook output}
             \PY{n}{output\PYZus{}notebook}\PY{p}{(}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} create a new plot with a title and axis labels}
             \PY{n}{p} \PY{o}{=} \PY{n}{figure}\PY{p}{(}\PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{,} 
                        \PY{n}{x\PYZus{}axis\PYZus{}type}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{datetime}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
                        \PY{n}{plot\PYZus{}width}\PY{o}{=}\PY{l+m+mi}{800}\PY{p}{,} 
                        \PY{n}{plot\PYZus{}height}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} 
                        \PY{n}{x\PYZus{}axis\PYZus{}label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{timestamp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                        \PY{n}{y\PYZus{}axis\PYZus{}label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{term}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         
             \PY{k}{for} \PY{n}{term} \PY{o+ow}{in} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
                 \PY{n}{color} \PY{o}{=} \PY{n+nb}{next}\PY{p}{(}\PY{n}{colorgen}\PY{p}{)}
                 \PY{n}{source} \PY{o}{=} \PY{n}{ColumnDataSource}\PY{p}{(}\PY{n}{frame}\PY{p}{[}\PY{n}{frame}\PY{o}{.}\PY{n}{term} \PY{o}{==} \PY{n}{term}\PY{p}{]}\PY{p}{)}
                 \PY{n}{p}\PY{o}{.}\PY{n}{circle}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tweetTime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                          \PY{n}{y}\PY{o}{=}\PY{n}{jitter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tweet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{width}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n+nb}{range}\PY{o}{=}\PY{n}{p}\PY{o}{.}\PY{n}{y\PYZus{}range}\PY{p}{)}\PY{p}{,} 
                          \PY{n}{fill\PYZus{}color}\PY{o}{=}\PY{n}{color}\PY{p}{,} 
                          \PY{n}{source}\PY{o}{=}\PY{n}{source}\PY{p}{,} 
                          \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.6}
                         \PY{p}{)}
         
             \PY{n}{p}\PY{o}{.}\PY{n}{x\PYZus{}range}\PY{o}{.}\PY{n}{range\PYZus{}padding} \PY{o}{=} \PY{l+m+mi}{0}
             \PY{n}{p}\PY{o}{.}\PY{n}{ygrid}\PY{o}{.}\PY{n}{grid\PYZus{}line\PYZus{}color} \PY{o}{=} \PY{k+kc}{None}
             \PY{c+c1}{\PYZsh{} p.legend.orientation = \PYZdq{}horizontal\PYZdq{}}
         
             \PY{c+c1}{\PYZsh{} limit the displayed tick locations to those corresponding to the }
             \PY{c+c1}{\PYZsh{} terms in the dataframe }
             \PY{n}{tick\PYZus{}locations} \PY{o}{=} \PY{p}{[}\PY{n}{x} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{terms}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}
             \PY{n}{p}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{ticker} \PY{o}{=} \PY{n}{FixedTicker}\PY{p}{(}\PY{n}{ticks}\PY{o}{=}\PY{n}{tick\PYZus{}locations}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Now add the labels instead of the numbers to the y axis}
             \PY{n}{p}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{formatter} \PY{o}{=} \PY{n}{FuncTickFormatter}\PY{o}{.}\PY{n}{from\PYZus{}py\PYZus{}func}\PY{p}{(}\PY{n}{ticker}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} show the results}
             \PY{n}{show}\PY{p}{(}\PY{n}{p}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}64}]:} \PY{n}{terms} \PY{o}{=} \PY{n}{userIds}\PY{o}{.}\PY{n}{columns}
         \PY{n}{plot\PYZus{}tweet\PYZus{}distributions}\PY{p}{(}\PY{n}{tweet\PYZus{}timestamps}\PY{p}{,} \PY{n}{terms}\PY{p}{)}
\end{Verbatim}


    
    
    
    
    
    
    
    

    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
